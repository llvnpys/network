# **TCP 클라이언트-서버 애플리케이션**
## **1. 개요**

본 프로그램은 **TCP** 기반의 클라이언트-서버 애플리케이션으로, 사용자는 서버와 연결해 파일 전송, 메시지 송수신 등의 작업을 수행할 수 있습니다. 멀티스레딩을 활용해 여러 클라이언트의 요청을 동시에 처리할 수 있으며, 파일 전송 시 진행률을 제공하는 등 다양한 기능을 지원합니다.

## **2. 프로그램 구조**

프로그램은 다음과 같은 주요 클래스들로 구성됩니다:

- `Client`: 클라이언트의 메인 클래스. 서버와의 연결을 처리하고, 메시지 및 파일 전송을 관리.
- `ReceiveThread`: 서버로부터 메시지를 수신하는 스레드로, 클라이언트 측에서 별도로 실행.
- `ClientHandler`: 서버가 각 클라이언트의 요청을 처리하고, 클라이언트 간의 메시지를 중계하는 역할.
- `SendThread`: 클라이언트 측에서 사용자 입력을 받아 서버로 전송하는 스레드.
- `ChatServerThread`: 채팅 서버의 클라이언트 연결 및 메시지 처리를 담당하는 서버 스레드.
- `ClientSocket`: 클라이언트 소켓 관리를 통해 메시지 및 파일 전송을 처리하는 클래스.
- `FileServerThread`: 파일 전송 요청을 처리하는 서버 측 스레드.
- `Server`: 서버 메인 클래스. 클라이언트 연결을 수락하고, 각 클라이언트에 대해 개별 스레드를 생성.
- `ServerHandler`: 서버 측에서 클라이언트 요청을 처리하고, 메시지 및 파일 전송을 담당.

## **3. 설계 구조**

### 3.1 클라이언트

### 3.1.1 Client (클라이언트)

- **역할**: 서버와 연결해 메시지 및 파일 전송을 처리하며, 사용자와의 상호작용을 담당.
- **주요 메서드**:
    - `run()`: 서버와의 통신 루프를 실행하고, 메시지를 주고받음.
    - `sendMessage()`: 사용자의 입력을 받아 메시지를 서버로 전송.
    - `receiveFile()`: 서버로부터 파일을 수신하고 로컬에 저장.

### 3.1.2 ClientHandler (클라이언트 처리)

- **역할**: 서버에서 각 클라이언트의 요청을 처리하며, 메시지 중계를 담당.
- **주요 메서드**:
    - `run()`: 클라이언트의 연결을 유지하며, 수신된 메시지를 다른 클라이언트에게 브로드캐스트.
    - `broadcast()`: 모든 클라이언트에게 메시지를 전송.

### 3.1.3 ReceiveThread (메시지 수신 스레드)

- **역할**: 서버로부터 메시지를 수신하고 사용자에게 출력하는 스레드.
- **주요 메서드**:
    - `run()`: 메시지를 계속해서 수신하며, 이를 콘솔에 출력.

### 3.1.4 SendThread (메시지 송신 스레드)

- **역할**: 사용자 입력을 받아 서버로 전송하는 스레드.
- **주요 메서드**:
    - `run()`: 사용자 입력을 실시간으로 받아 서버에 전송.

### 3.2 서버

### 3.2.1 Server (서버 메인 클래스)

- **역할**: 서버 프로그램의 진입점 역할을 하며, 클라이언트 연결을 처리.
- **주요 메서드**:
    - `start()`: 서버를 시작하고, 클라이언트의 연결을 대기.

### 3.2.2 ServerHandler (서버 요청 처리 핸들러)

- **역할**: 채팅방 생성, 참여, 상태 확인, 퇴장, 메시지 전송, 파일 송수신 등의 클라이언트 요청을 처리.
- **주요 메서드**:
    - `create()`: 새로운 채팅방을 생성하고 클라이언트를 추가.
    - `join()`: 클라이언트를 기존 채팅방에 추가.
    - `status()`: 클라이언트가 속한 채팅방의 정보를 출력.
    - `exit()`: 클라이언트가 채팅방을 나가며, 채팅방에 남은 클라이언트가 없으면 채팅방을 삭제.
    - `sendMessage()`: 클라이언트로부터 받은 메시지를 같은 채팅방의 다른 클라이언트들에게 브로드캐스트.
    - `put()`: 클라이언트로부터 파일을 수신하고 서버에 저장.
    - `get()`: 서버에 저장된 파일을 클라이언트에게 전송.
    - `broadcastToRoom()`: 채팅방 내 다른 클라이언트들에게 메시지를 전송.
    - `sendToMe()`: 특정 클라이언트에게 메시지를 전송.

### 3.2.3 ChatServerThread (채팅 서버 스레드)

- **역할**: 새로운 클라이언트의 연결을 처리하고, 각 클라이언트에 대한 개별 스레드를 생성.
- **주요 메서드**:
    - `run()`: 새로운 클라이언트가 연결되면, 이를 처리하고 각 클라이언트에 대해 새로운 스레드를 생성.

### 3.2.4 FileServerThread (파일 전송 스레드)

- **역할**: 서버에서 클라이언트로 파일 전송을 담당하는 스레드.
- **주요 메서드**:
    - `run()`: 파일 전송 요청을 처리하고 파일을 클라이언트에 전송.


### 3.2.5 ClientSocket (클라이언트 소켓 관리 클래스)

- **역할**: 서버에서 클라이언트의 채팅 및 파일 전송을 위한 소켓과 스트림을 관리.
- **주요 메서드**:
  - `getChatIn()`, `getChatOut()`: 채팅 스트림을 반환.
  - `getFileIn()`, `getFileOut()`: 파일 전송 스트림을 반환.
  - `closeSockets()`: 모든 소켓과 스트림을 닫아 자원을 반환.


## **4. 프로토콜 및 메시지 처리**

### 4.1. 메시지 전송 프로토콜

- **텍스트 메시지**: 사용자는 텍스트 메시지를 입력해 서버로 전송하며, 서버는 이를 연결된 모든 클라이언트에 브로드캐스트함.
- **파일 전송**: 사용자가 파일을 선택해 전송 요청을 보내면, 서버는 파일 크기와 내용을 클라이언트에게 전송하고, 클라이언트는 이를 저장.

### 4.2. 파일 전송 처리

- 파일 전송 시, 서버는 먼저 파일 크기를 클라이언트에게 전달한 후, 파일 내용을 여러 청크로 나누어 전송함.
- 클라이언트는 전송 중 파일 진행 상태를 출력하며, 파일 수신이 완료되면 저장 후 완료 메시지를 출력.

## **5. 실행 방법**

### 5.1. 컴파일 및 실행

1. **서버 실행**:
    - `javac Server.java`
    - `java Server`
2. **클라이언트 실행**:
    - `javac Client.java`
    - `java Client`

### 5.2. 명령어 사용

- **메시지 전송**: 클라이언트 측에서 메시지를 입력하고 `Enter`를 누르면 서버를 통해 모든 클라이언트에게 메시지가 전송됨.
- **파일 전송**: `sendFile <fileName>` 명령어를 통해 서버로 파일 전송을 요청할 수 있음.

### **5.2. 명령어 예시**

- `#CREATE <채팅방 이름> <참여자 이름>`
    - **기능**: 새로운 채팅방을 생성합니다. 이미 동일한 이름의 채팅방이 있을 경우 실패 메시지를 반환합니다.
    - **예시**: `#CREATE room1 Alice`
    - **성공 시**: "Chatroom 'room1' created successfully. You have joined the room1"
    - **실패 시**: "The chatroom already exists."

- `#JOIN <채팅방 이름> <참여자 이름>`
    - **기능**: 기존의 채팅방에 참여합니다. 채팅방이 없을 경우 실패 메시지를 반환합니다.
    - **예시**: `#JOIN room1 Bob`
    - **성공 시**: "Bob have successfully joined the room1"
    - **실패 시**: "The chatroom does not exist."

- `#STATUS`
    - **기능**: 참여한 채팅방의 이름과 현재 채팅방에 참여한 사람들의 리스트를 출력합니다. 채팅방에 속하지 않은 경우 실패 메시지를 반환합니다.
    - **예시**: `#STATUS`
    - **성공 시**: "Room Name: room1\nClient List: Alice Bob"
    - **실패 시**: "You are not in any chatroom."

- `#EXIT`
  - **기능**: 현재 참여한 채팅방에서 나가고, 남은 참여자들에게 퇴장 메시지를 전송한 뒤, 프로그램을 종료합니다. 채팅방에 속하지 않은 경우 실패 메시지를 반환합니다.
  - **예시**: `#EXIT`
  - **성공 시**: "Alice has left the room1"
  - **실패 시**: "You are not in any chatroom."
  - **동작**: 퇴장 메시지를 다른 참여자에게 전송한 후 클라이언트 프로그램이 종료됩니다.

- `#PUT <파일 이름>`
    - **기능**: 지정된 파일을 서버에 업로드합니다. 성공적으로 업로드되면 다른 참여자들에게 파일이 업로드되었음을 알립니다.
    - **예시**: `#PUT example.txt`
    - **성공 시**: "File example.txt sent successfully."

- `#GET <파일 이름>`
    - **기능**: 지정된 파일을 서버로부터 다운로드받습니다. 성공적으로 파일을 수신하면 완료 메시지를 출력합니다.
    - **예시**: `#GET example.txt`
    - **성공 시**: "File example.txt downloaded successfully. From client: room1"
